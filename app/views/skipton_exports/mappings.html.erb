<div class="max-w-6xl mx-auto p-6">
  <div class="bg-white rounded-lg shadow-md p-6">
    <div class="flex justify-between items-center mb-6">
      <div>
        <h1 class="text-2xl font-bold">Customer Mappings</h1>
        <p class="text-sm text-gray-600 mt-1">Xero customer names â†’ Skipton IDs</p>
      </div>
      <%= link_to "â† Back to Export", skipton_exports_path, class: "text-sm text-blue-600 hover:text-blue-800 underline" %>
    </div>

    <% if flash[:notice] %>
      <div class="mb-4 p-4 bg-green-50 border border-green-200 rounded text-green-700">
        <%= flash[:notice] %>
      </div>
    <% end %>

    <% if flash[:alert] %>
      <div class="mb-4 p-4 bg-red-50 border border-red-200 rounded text-red-700">
        <%= flash[:alert] %>
      </div>
    <% end %>

    <!-- Add New Mapping Form -->
    <div class="mb-6 p-4 bg-gray-50 border border-gray-200 rounded">
      <h3 class="font-semibold mb-3">Add New Mapping</h3>
      <%= form_with url: skipton_mappings_path, method: :post, class: "flex gap-3 items-end" do |f| %>
        <div class="flex-1">
          <label class="block text-xs font-medium text-gray-700 mb-1">
            Xero Customer Name <span class="text-red-500">*</span>
          </label>
          <%= f.text_field :xero_name,
                          placeholder: "e.g. Acme Manufacturing Ltd",
                          required: true,
                          class: "w-full px-3 py-2 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
        </div>
        <div class="w-48">
          <label class="block text-xs font-medium text-gray-700 mb-1">
            Skipton ID <span class="text-red-500">*</span>
          </label>
          <%= f.text_field :skipton_id,
                          placeholder: "e.g. 083812-001",
                          required: true,
                          class: "w-full px-3 py-2 border border-gray-300 rounded text-sm font-mono focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
        </div>
        <%= f.submit "Add Mapping",
                     class: "px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 font-medium cursor-pointer" %>
      <% end %>
    </div>

    <!-- Search -->
    <%= form_with url: skipton_mappings_path, method: :get, class: "mb-4" do |f| %>
      <div class="flex gap-3">
        <%= f.text_field :search,
                        value: params[:search],
                        placeholder: "Search by customer name or Skipton ID...",
                        class: "flex-1 px-4 py-2 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
        <%= f.submit "Search", class: "px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 font-medium cursor-pointer" %>
        <% if params[:search].present? %>
          <%= link_to "Clear", skipton_mappings_path, class: "px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 font-medium" %>
        <% end %>
      </div>
    <% end %>

    <!-- Stats -->
    <div class="mb-4 flex gap-4 text-sm">
      <div class="px-4 py-2 bg-blue-50 rounded">
        <strong><%= @mappings.total_count %></strong> total mappings
      </div>
      <% if @unmapped_count > 0 %>
        <div class="px-4 py-2 bg-yellow-50 rounded">
          <strong><%= @unmapped_count %></strong> customers with invoices still unmapped
        </div>
      <% end %>
    </div>

    <!-- Mappings Table -->
    <div class="border rounded-lg overflow-hidden">
      <table class="w-full">
        <thead class="bg-gray-100 border-b">
          <tr>
            <th class="text-left p-3 text-sm font-semibold">Xero Customer Name</th>
            <th class="text-left p-3 text-sm font-semibold w-48">Skipton ID</th>
            <th class="text-left p-3 text-sm font-semibold w-32">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% if @mappings.any? %>
            <% @mappings.each do |mapping| %>
              <tr class="border-b hover:bg-gray-50">
                <td class="p-3 text-sm">
                  <%= mapping.xero_name %>
                </td>
                <td class="p-3 text-sm font-mono">
                  <%= mapping.skipton_id %>
                </td>
                <td class="p-3 text-sm">
                  <div class="flex gap-2">
                    <%= button_to "Edit",
                                  edit_skipton_mapping_path(mapping),
                                  method: :get,
                                  class: "text-blue-600 hover:text-blue-800 underline text-xs" %>
                    <%= button_to "Delete",
                                  skipton_mapping_path(mapping),
                                  method: :delete,
                                  data: { confirm: "Are you sure? This will cause export errors for invoices using '#{mapping.xero_name}'" },
                                  class: "text-red-600 hover:text-red-800 underline text-xs" %>
                  </div>
                </td>
              </tr>
            <% end %>
          <% else %>
            <tr>
              <td colspan="3" class="p-8 text-center text-gray-500">
                <% if params[:search].present? %>
                  No mappings found matching "<%= params[:search] %>"
                <% else %>
                  No mappings yet. Add your first mapping above.
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <% if @mappings.total_pages > 1 %>
      <div class="mt-4 flex justify-center">
        <%= paginate @mappings, theme: 'twitter-bootstrap-4' %>
      </div>
    <% end %>
  </div>

  <!-- Help Section -->
  <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded">
    <h3 class="font-semibold mb-2">ðŸ’¡ Tips</h3>
    <ul class="text-sm space-y-1 list-disc list-inside">
      <li>The Xero name must match <strong>exactly</strong> what appears in your Xero invoices</li>
      <li>Check capitalization, punctuation, and spacing - "Ltd" vs "Limited" matters</li>
      <li>Get Skipton IDs from your Skipton Business Finance account</li>
      <li>Deleting a mapping will cause export errors for any invoices using that customer</li>
    </ul>
  </div>
</div>
