# views/works_orders/ecard.html.erb
<div class="container mx-auto px-4 py-6">
  <h1>E-Card: WO<%= @works_order.number %></h1>

  <% if @works_order.part&.locked_for_editing? %>
    <% @works_order.part.locked_operations.each do |operation| %>
      <div class="border p-4 mb-4 <%= operation_signed_off?(@works_order, operation) ? 'bg-green-50' : 'bg-gray-50' %>">
        <h3>Op <%= operation["position"] %>: <%= operation["display_name"] %></h3>
        <p><%= operation["operation_text"] %></p>

        <% if operation_signed_off?(@works_order, operation) %>
          <span class="text-green-600">âœ“ Signed off</span>
        <% else %>
          <%= button_to "Sign Off",
              sign_off_operation_works_order_path(@works_order),
              params: { operation_position: operation["position"] },
              method: :patch,
              class: "bg-blue-500 text-white px-4 py-2 rounded" %>
        <% end %>
      </div>
    <% end %>
  <% else %>
    <!-- For parts that aren't locked (shouldn't happen for existing parts but fallback) -->
    <% @works_order.operations_with_auto_ops.each_with_index do |operation, index| %>
      <div class="border p-4 mb-4 bg-gray-50">
        <h3>Op <%= index + 1 %>: <%= operation.display_name %></h3>
        <p><%= operation.operation_text %></p>
        <p class="text-sm text-gray-600">Note: This part is not in manual editing mode, so sign-offs are not available.</p>
      </div>
    <% end %>
  <% end %>

  <% if @works_order.part.nil? %>
    <div class="border p-4 mb-4 bg-red-50">
      <p class="text-red-600">No part associated with this works order.</p>
    </div>
  <% elsif @works_order.part.locked_operations.empty? && @works_order.operations_with_auto_ops.empty? %>
    <div class="border p-4 mb-4 bg-yellow-50">
      <p class="text-yellow-600">No operations configured for this part.</p>
    </div>
  <% end %>
</div>
