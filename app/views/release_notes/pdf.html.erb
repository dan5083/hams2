<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <style>
      body {
        font-family: sans-serif;
        font-size: 10pt;
        margin: 0;
        padding: 0;
        --standard-border-width: 1pt;
        --standard-border-color: black;
        --standard-border-style: solid;
      }

      @page {
        size: A4 portrait;
        margin: 1.5cm 1.5cm;
      }

      .page {
        page-break-after: always;
        min-height: calc(100vh - 3cm);
      }

      .page:last-child {
        page-break-after: avoid;
      }

      .logo-header {
        text-align: center;
        margin-bottom: 1.5rem;
      }

      .logo-header img {
        max-width: 300px;
        height: auto;
      }

      h1 {
        text-align: center;
        margin: 1rem 0;
        font-size: 1.5em;
      }

      h2 {
        font-size: 1em;
        margin: 1rem 0 0.5rem 0;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1rem;
      }

      th, td {
        border-color: var(--standard-border-color);
        border-style: var(--standard-border-style);
        border-width: var(--standard-border-width);
        padding: 0.5rem;
        vertical-align: top;
      }

      th {
        background-color: #f8f9fa;
        font-weight: bold;
        text-align: left;
        width: 30%;
      }

      .addresses {
        table-layout: fixed;
        margin-bottom: 1.5rem;
      }

      .address {
        width: 33.33%;
        vertical-align: top;
        padding: 0.5rem;
      }

      .address h2 {
        font-size: 1em;
        margin: 0 0 0.5rem 0;
        text-decoration: underline;
      }

      .address p {
        margin: 0;
        line-height: 1.4;
      }

      .header-table {
        margin-bottom: 1.5rem;
      }

      .detail-table {
        margin-top: 1rem;
        margin-bottom: 1.5rem;
      }

      .signature-table {
        table-layout: fixed;
        margin-top: 1.5rem;
      }

      .signature-table th {
        width: 30%;
      }

      .signature-table td {
        height: 3rem;
      }

      .signature-name {
        font-family: 'Times New Roman', serif;
        font-size: 1.2em;
        font-style: italic;
        font-weight: bold;
      }

      .statement {
        margin: 1.5rem 0;
        padding: 1rem;
        border: 1pt solid #ccc;
        background-color: #f8f9fa;
      }

      .signature-block {
        margin-top: 2rem;
        text-align: center;
      }

      .thickness-table {
        margin-top: 1rem;
        margin-bottom: 1rem;
      }

      .thickness-table th {
        width: 50%;
      }

      .thickness-group {
        margin-bottom: 1rem;
      }

      .thickness-group-header {
        background-color: #e9ecef;
        font-weight: bold;
        padding: 0.25rem 0.5rem;
        border-bottom: 2pt solid #ccc;
      }

      p {
        margin: 0.5rem 0;
      }

      /* Compact spacing for single page */
      .compact {
        margin-bottom: 0.75rem;
      }
    </style>
  </head>
  <body>
    <!-- Page 1: Advice Note -->
    <div class="page">
      <!-- Logo Header -->
      <div class="logo-header">
        <%= image_tag("logo-with-company-name.png", alt: "Hard Anodising Surface Treatments Ltd") %>
      </div>

      <h1>Advice Note</h1>

      <!-- Header Information -->
      <table class="header-table compact">
        <tbody>
          <tr>
            <th>Release Note Number</th>
            <td>RN<%= @release_note.number %></td>
          </tr>
          <tr>
            <th>Date</th>
            <td><%= @release_note.date.strftime("%d/%m/%Y") %></td>
          </tr>
        </tbody>
      </table>

      <!-- Addresses -->
      <table class="addresses compact">
        <tbody>
          <tr>
            <td class="address">
              <h2>Invoice To</h2>
              <p>
                <%= @release_note.invoice_customer_name %><br/>
                <%= simple_format(@release_note.invoice_address) if @release_note.invoice_address %>
              </p>
            </td>
            <td class="address">
              <h2>Deliver To</h2>
              <p>
                <%= @release_note.delivery_customer_name %><br/>
                <%= simple_format(@release_note.delivery_address) if @release_note.delivery_address %>
              </p>
            </td>
            <td class="address">
              <!-- Empty third column for layout -->
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Release Note Details -->
      <table class="detail-table compact">
        <tbody>
          <tr>
            <th>Customer Order</th>
            <td>
              <%= @release_note.works_order.customer_order.number %>
              <% if @release_note.works_order.respond_to?(:customer_order_line) && @release_note.works_order.customer_order_line.present? %>
                (line <%= @release_note.works_order.customer_order_line %>)
              <% end %>
            </td>
          </tr>
          <tr>
            <th>Part Number</th>
            <td><%= @release_note.works_order.part_number %></td>
          </tr>
          <tr>
            <th>Issue</th>
            <td><%= @release_note.works_order.part_issue %></td>
          </tr>
          <tr>
            <th>Description</th>
            <td><%= @release_note.works_order.part_description %></td>
          </tr>
          <tr>
            <th>Quantity Accepted</th>
            <td><%= @release_note.quantity_accepted %></td>
          </tr>
          <tr>
            <th>Quantity Rejected</th>
            <td><%= @release_note.quantity_rejected %></td>
          </tr>
          <tr>
            <th>Our Works Order Number</th>
            <td>WO<%= @release_note.works_order.number %></td>
          </tr>
        </tbody>
      </table>

      <!-- Thickness Measurements (if present) - Simplified -->
      <% if @release_note.has_thickness_measurements? %>
        <h2>Thickness Measurements</h2>
        <% measurements_by_type = @release_note.thickness_measurements_by_type %>
        <% measurements_by_type.each do |process_type, measurements| %>
          <div class="thickness-group">
            <div class="thickness-group-header">
              <%= process_type.humanize.gsub('_', ' ').titleize %>
            </div>
            <table class="thickness-table">
              <thead>
                <tr>
                  <th>Treatment</th>
                  <th>Measured (Î¼m)</th>
                </tr>
              </thead>
              <tbody>
                <% measurements.each do |measurement| %>
                  <tr>
                    <td><%= measurement['display_name'] || measurement['process_type'].humanize.titleize %></td>
                    <td><%= measurement['measured_thickness'] %></td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        <% end %>
      <% end %>

      <!-- Proof of Collection/Delivery -->
      <h2>Proof of Collection/Delivery</h2>
      <table class="signature-table">
        <tbody>
          <tr>
            <th>Signature</th>
            <td></td>
          </tr>
          <tr>
            <th>Name</th>
            <td></td>
          </tr>
          <tr>
            <th>Date/Time</th>
            <td></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Page 2: Certificate of Conformity -->
    <div class="page">
      <!-- Logo Header -->
      <div class="logo-header">
        <%= image_tag("logo-with-company-name.png", alt: "Hard Anodising Surface Treatments Ltd") %>
      </div>

      <h1>Certificate of Conformity</h1>

      <!-- Header Information -->
      <table class="header-table compact">
        <tbody>
          <tr>
            <th>Release Note Number</th>
            <td>RN<%= @release_note.number %></td>
          </tr>
          <tr>
            <th>Date</th>
            <td><%= @release_note.date.strftime("%d/%m/%Y") %></td>
          </tr>
        </tbody>
      </table>

      <!-- Addresses -->
      <table class="addresses compact">
        <tbody>
          <tr>
            <td class="address">
              <h2>Invoice To</h2>
              <p>
                <%= @release_note.invoice_customer_name %><br/>
                <%= simple_format(@release_note.invoice_address) if @release_note.invoice_address %>
              </p>
            </td>
            <td class="address">
              <h2>Deliver To</h2>
              <p>
                <%= @release_note.delivery_customer_name %><br/>
                <%= simple_format(@release_note.delivery_address) if @release_note.delivery_address %>
              </p>
            </td>
            <td class="address">
              <!-- Empty third column for layout -->
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Release Note Details -->
      <table class="detail-table compact">
        <tbody>
          <tr>
            <th>Customer Order</th>
            <td>
              <%= @release_note.works_order.customer_order.number %>
              <% if @release_note.works_order.respond_to?(:customer_order_line) && @release_note.works_order.customer_order_line.present? %>
                (line <%= @release_note.works_order.customer_order_line %>)
              <% end %>
            </td>
          </tr>
          <tr>
            <th>Part Number</th>
            <td><%= @release_note.works_order.part_number %></td>
          </tr>
          <tr>
            <th>Issue</th>
            <td><%= @release_note.works_order.part_issue %></td>
          </tr>
          <tr>
            <th>Description</th>
            <td><%= @release_note.works_order.part_description %></td>
          </tr>
          <tr>
            <th>Specification</th>
            <td><%= @release_note.specification %></td>
          </tr>
          <tr>
            <th>Quantity Accepted</th>
            <td><%= @release_note.quantity_accepted %></td>
          </tr>
          <tr>
            <th>Quantity Rejected</th>
            <td><%= @release_note.quantity_rejected %></td>
          </tr>
          <tr>
            <th>Our Works Order Number</th>
            <td>WO<%= @release_note.works_order.number %></td>
          </tr>
        </tbody>
      </table>

      <!-- Simplified Thickness Measurements for Certificate -->
      <% if @release_note.has_thickness_measurements? %>
        <h2>Certified Thickness Measurements</h2>
        <% measurements_by_type = @release_note.thickness_measurements_by_type %>
        <% measurements_by_type.each do |process_type, measurements| %>
          <div class="thickness-group">
            <div class="thickness-group-header">
              <%= process_type.humanize.gsub('_', ' ').titleize %>
            </div>
            <table class="thickness-table">
              <thead>
                <tr>
                  <th>Treatment Description</th>
                  <th>Measured Thickness (Î¼m)</th>
                </tr>
              </thead>
              <tbody>
                <% measurements.each do |measurement| %>
                  <tr>
                    <td><%= measurement['display_name'] || measurement['process_type'].humanize.titleize %></td>
                    <td><%= measurement['measured_thickness'] %></td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        <% end %>
      <% end %>

      <!-- Statement -->
      <h2>Statement</h2>
      <div class="statement">
        <p><%= simple_format(@release_note.remarks) if @release_note.remarks.present? %></p>
      </div>

      <!-- Signature Block -->
      <div class="signature-block">
        <p>
          <span class="signature-name"><%= @release_note.issued_by.display_name %></span><br/>
          For and on behalf of Hard Anodising Surface Treatments Ltd
        </p>
      </div>
    </div>
  </body>
</html>
