<h1>Advice Note</h1>

  <!-- Header Information -->
  <table class="header-table compact">
    <tbody>
      <tr>
        <th>Release Note Number</th>
        <td>RN<%= @release_note.number %></td>
      </tr>
      <tr>
        <th>Date</th>
        <td><%= @release_note.date.strftime("%d/%m/%Y") %></td>
      </tr>
    </tbody>
  </table>

  <!-- Invoice Address Only (removed deliver to) -->
  <table class="addresses compact">
    <tbody>
      <tr>
        <td class="address">
          <h2>Invoice To</h2>
          <p>
            <%= @release_note.works_order.customer_order.customer.display_name %><br/>
            <%= simple_format(@release_note.works_order.customer_order.customer.pdf_address) %>
          </p>
        </td>
        <td class="address">
          <!-- Empty space for balance -->
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Customer Reference (if present) - Full width row, no label -->
  <% if @release_note.works_order.customer_reference.present? %>
    <div class="customer-reference-row">
      <%= @release_note.works_order.customer_reference %>
    </div>
  <% end %>

  <!-- Release Note Details -->
  <table class="detail-table compact">
    <tbody>
      <tr>
        <th>Customer Order</th>
        <td>
          <%= @release_note.works_order.customer_order.number %>
          <% if @release_note.works_order.respond_to?(:customer_order_line) && @release_note.works_order.customer_order_line.present? %>
            (line <%= @release_note.works_order.customer_order_line %>)
          <% end %>
        </td>
      </tr>
      <tr>
        <th>Part Number</th>
        <td><%= @release_note.works_order.part_number %></td>
      </tr>
      <tr>
        <th>Issue</th>
        <td><%= @release_note.works_order.part_issue %></td>
      </tr>
      <tr>
        <th>Description</th>
        <td><%= @release_note.works_order.part_description %></td>
      </tr>
      <tr>
        <th>Quantity Accepted</th>
        <td><%= @release_note.quantity_accepted %></td>
      </tr>
      <tr>
        <th>Quantity Rejected</th>
        <td><%= @release_note.quantity_rejected %></td>
      </tr>
      <tr>
        <th>Our Works Order Number</th>
        <td>WO<%= @release_note.works_order.number %></td>
      </tr>
    </tbody>
  </table>

  <!-- Thickness Measurements (if present) - Simplified -->
  <% if @release_note.has_thickness_measurements? %>
    <h2>Thickness Measurements</h2>
    <% measurements_by_type = @release_note.thickness_measurements_by_type %>
    <% measurements_by_type.each do |process_type, measurements| %>
      <div class="thickness-group">
        <div class="thickness-group-header">
          <%= process_type.humanize.gsub('_', ' ').titleize %>
        </div>
        <table class="thickness-table">
          <thead>
            <tr>
              <th>Treatment</th>
              <th>Measured (μm)</th>
            </tr>
          </thead>
          <tbody>
            <% measurements.each do |measurement| %>
              <tr>
                <td><%= measurement['display_name'] || measurement['process_type'].humanize.titleize %></td>
                <td><%= measurement['measured_thickness'] %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% end %>
  <% end %>

  <!-- Proof of Collection/Delivery -->
  <h2>Proof of Collection/Delivery</h2>
  <table class="signature-table">
    <tbody>
      <tr>
        <th>Signature</th>
        <td></td>
      </tr>
      <tr>
        <th>Name</th>
        <td></td>
      </tr>
      <tr>
        <th>Date/Time</th>
        <td></td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Page 2+: Certificate of Conformity (Can use multiple sides) -->
<div class="certificate-page">
  <div class="certificate-content">
    <!-- Logo Header -->
    <div class="logo-header">
      <%= image_tag("logo-with-company-name.png", alt: "Hard Anodising Surface Treatments Ltd") %>
      <!-- Company contact info in header -->
      <div class="company-contact">
        Firs Industrial Estate, Rickets Close, Kidderminster DY11 7QN<br/>
        Tel: 01562 747100 | <a href="https://www.hard-anodising.co.uk/">www.hard-anodising.co.uk</a>
      </div>
    </div>

    <h1>Certificate of Conformity</h1>

    <!-- Header Information -->
    <table class="header-table compact">
      <tbody>
        <tr>
          <th>Release Note Number</th>
          <td>RN<%= @release_note.number %></td>
        </tr>
        <tr>
          <th>Date</th>
          <td><%= @release_note.date.strftime("%d/%m/%Y") %></td>
        </tr>
      </tbody>
    </table>

    <!-- Invoice Address Only (removed deliver to) -->
    <table class="addresses compact">
      <tbody>
        <tr>
          <td class="address">
            <h2>Invoice To</h2>
            <p>
              <%= @release_note.works_order.customer_order.customer.display_name %><br/>
              <%= simple_format(@release_note.works_order.customer_order.customer.pdf_address) %>
            </p>
          </td>
          <td class="address">
            <!-- Empty space for balance -->
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Customer Reference (if present) - Full width row, no label -->
    <% if @release_note.works_order.customer_reference.present? %>
      <div class="customer-reference-row">
        <%= @release_note.works_order.customer_reference %>
      </div>
    <% end %>

    <!-- Release Note Details -->
    <table class="detail-table compact">
      <tbody>
        <tr>
          <th>Customer Order</th>
          <td>
            <%= @release_note.works_order.customer_order.number %>
            <% if @release_note.works_order.respond_to?(:customer_order_line) && @release_note.works_order.customer_order_line.present? %>
              (line <%= @release_note.works_order.customer_order_line %>)
            <% end %>
          </td>
        </tr>
        <tr>
          <th>Part Number</th>
          <td><%= @release_note.works_order.part_number %></td>
        </tr>
        <tr>
          <th>Issue</th>
          <td><%= @release_note.works_order.part_issue %></td>
        </tr>
        <tr>
          <th>Description</th>
          <td><%= @release_note.works_order.part_description %></td>
        </tr>
        <tr>
          <th>Specification</th>
          <td><%= @release_note.specification %></td>
        </tr>
        <tr>
          <th>Quantity Accepted</th>
          <td><%= @release_note.quantity_accepted %></td>
        </tr>
        <tr>
          <th>Quantity Rejected</th>
          <td><%= @release_note.quantity_rejected %></td>
        </tr>
        <tr>
          <th>Our Works Order Number</th>
          <td>WO<%= @release_note.works_order.number %></td>
        </tr>
      </tbody>
    </table>

    <!-- Simplified Thickness Measurements for Certificate -->
    <% if @release_note.has_thickness_measurements? %>
      <h2>Certified Thickness Measurements</h2>
      <% measurements_by_type = @release_note.thickness_measurements_by_type %>
      <% measurements_by_type.each do |process_type, measurements| %>
        <div class="thickness-group">
          <div class="thickness-group-header">
            <%= process_type.humanize.gsub('_', ' ').titleize %>
          </div>
          <table class="thickness-table">
            <thead>
              <tr>
                <th>Treatment Description</th>
                <th>Measured Thickness (μm)</th>
              </tr>
            </thead>
            <tbody>
              <% measurements.each do |measurement| %>
                <tr>
                  <td><%= measurement['display_name'] || measurement['process_type'].humanize.titleize %></td>
                  <td><%= measurement['measured_thickness'] %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% end %>
    <% end %>

    <!-- Statement -->
    <h2>Statement</h2>
    <div class="statement">
      <p><%= simple_format(@release_note.remarks) if @release_note.remarks.present? %></p>
    </div>

    <!-- Signature Block -->
    <div class="signature-block">
      <p>
        <span class="signature-name"><%= @release_note.issued_by.display_name %></span><br/>
        For and on behalf of Hard Anodising Surface Treatments Ltd
      </p>
    </div>

    <!-- Company Footer -->
    <div class="company-footer">
      <strong>Hard Anodising Surface Treatments Ltd</strong><br/>
      Firs Industrial Estate, Rickets Close, Kidderminster DY11 7QN<br/>
      Tel: 01562 747100 | <a href="https://www.hard-anodising.co.uk/">www.hard-anodising.co.uk</a>
    </div>
  </div>
</div>
